<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <!-- polyfill -->
    <script src="midijs/inc/shim/Base64.js" type="text/javascript"></script>
    <script src="midijs/inc/shim/Base64binary.js" type="text/javascript"></script>
    <script src="midijs/inc/shim/WebAudioAPI.js" type="text/javascript"></script>
    <!-- midi.js package -->
    <script src="midijs/js/midi/audioDetect.js" type="text/javascript"></script>
    <script src="midijs/js/midi/gm.js" type="text/javascript"></script>
    <script src="midijs/js/midi/loader.js" type="text/javascript"></script>
    <script src="midijs/js/midi/plugin.audiotag.js" type="text/javascript"></script>
    <script src="midijs/js/midi/plugin.webaudio.js" type="text/javascript"></script>
    <script src="midijs/js/midi/plugin.webmidi.js" type="text/javascript"></script>
    <!--<script src="midijs/js/midi/player.js"></script>-->
    <!-- utils -->
    <script src="midijs/js/util/dom_request_xhr.js" type="text/javascript"></script>
    <script src="midijs/js/util/dom_request_script.js" type="text/javascript"></script>

    <script src="index.js"></script>
    <title>Title</title>
</head>
<body>
<script type="text/javascript">

    window.onload = function () {
        MIDI.loadPlugin({
            soundfontUrl: "midijs/examples/soundfont/",
            instrument: "acoustic_grand_piano",
            onprogress: function (state, progress) {
                console.log(state, progress);
            },
            onsuccess: function () {
                console.log('load success');
                playNextTSeconds(4);
                playNextTSeconds(2);
            }
        });
    };

    var player = {
        barDuration: 2,
        timeline: 1,
        velocity: 127,
        play: function (noteInt, duration, moveTime) {

            MIDI.noteOn(0, noteInt, this.velocity, this.timeline);
            // звучание ноты заканчивается через длительность такта * длительность ноты в такте
            var endTime = this.barDuration * duration;
            MIDI.noteOff(0, noteInt, this.velocity, this.timeline + endTime);

            if (typeof moveTime !== 'undefined' && moveTime === true) {
                this.timeline += endTime
            }
        }
    };

</script>
</body>
</html>